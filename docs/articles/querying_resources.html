<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Complex queries • gtR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Complex queries">
<meta property="og:description" content="gtR">
<meta property="og:image" content="https://shanej90.github.io/gtR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/gtR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gtR_combinations.html">Results related to a specific entity</a>
    </li>
    <li>
      <a href="../articles/querying_resources.html">Complex queries</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Complex queries</h1>
            
      
      
      <div class="hidden name"><code>querying_resources.Rmd</code></div>

    </div>

    
    
<p>The <a href="gtR.html">getting started page</a> covers a relatively simple query where we’re trying to just get a single list of results. More complex queries may require a bit more thought.</p>
<p><strong>NB I won’t show some actual data outputs as there are some hideously long ID strings in there</strong>.</p>
<div class="section level2">
<h2 id="combinations">Combinations<a class="anchor" aria-label="anchor" href="#combinations"></a>
</h2>
<p>What if we wanted to find projects linked to a specific institution? Let’s (completely randomly) say we’d like to take a look at the University of Exeter. To start with, we need to know the ID for Exeter to specify which institution we’re interested in when we send the request. First we need to know how we can potentially narrow down results to make searching easier.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">configuration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_configs.html">get_configs</a></span><span class="op">(</span>resource <span class="op">=</span> <span class="st">"organisation"</span><span class="op">)</span> <span class="co">#because we want details about an organisation</span>

<span class="co">#now we want to see field details for that resource:</span>
<span class="va">configuration</span><span class="op">$</span><span class="va">fields</span>
<span class="co">#&gt;          code       description searchable sortable searchedByDefault</span>
<span class="co">#&gt; 1       org.n Organisation Name       TRUE     TRUE              TRUE</span>
<span class="co">#&gt; 2   org.pro.t    Project Titles       TRUE    FALSE             FALSE</span>
<span class="co">#&gt; 3 org.orcidId          ORCID iD       TRUE    FALSE              TRUE</span>
<span class="co">#&gt; 4   org.pro.a Project Abstracts       TRUE    FALSE             FALSE</span>
<span class="co">#&gt; 5       score         Relevance      FALSE     TRUE             FALSE</span></code></pre></div>
<p>Great - we can see from the above that the <code>org.n</code> field can be searched and that this corresponds to the organisation name. We can also see <code>org.n</code> is searched by default so we don’t need to specify it using the <code>s_fields</code> argument.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_resources.html">get_resources</a></span><span class="op">(</span>
  resource <span class="op">=</span> <span class="st">"organisation"</span>, <span class="co">#because we're looking for an organisation</span>
  search_term <span class="op">=</span> <span class="st">"Exeter"</span> <span class="co"># to try and narrow down the field of results without being too specific</span>
  <span class="co">#no more arguments as we don't want to narrow down the results any further</span>
<span class="op">)</span></code></pre></div>
<p>Luckily, here, the University is in the first few results. But it might not have been and we got &gt;1,200 rows of data. This could’ve been narrowed down by exploring fields, eg, perhaps using <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> to search for ‘University’ in the <code>name</code> field. But the important thing is the <code>id</code> column gives us what we’re after.</p>
<p>To find projects we need to specify an <code>output</code> as well as a resource (if you’re only interested in a single resource/type of entity, you don’t need to specify <code>output</code> or <code>resource_id</code> arguments).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#there are a LOT of projects related to Exeter so this query will take a while to</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_resources.html">get_resources</a></span><span class="op">(</span>
  resource <span class="op">=</span> <span class="st">"organisation"</span>, <span class="co">#because the University of Exeter is an organisation</span>
  output <span class="op">=</span> <span class="st">"project"</span>, <span class="co">#because we want to find projects associated with UoE</span>
  resource_id <span class="op">=</span> <span class="st">"961756BF-E31F-4A13-836F-0A09BA02385C"</span>, <span class="co">#we found this ID in the 'getting started' example,</span>
  page_nums <span class="op">=</span> <span class="fl">1</span>, <span class="co"># only specifying one page number as to keep number of results small</span>
  size <span class="op">=</span> <span class="fl">10</span> <span class="co">#as above</span>
  <span class="co">#we won't worry about other arguments as we're happy to leave them blank on this occasion</span>
<span class="op">)</span></code></pre></div>
<p>And you have your results!</p>
</div>
<div class="section level2">
<h2 id="using-results-downstream">Using results downstream<a class="anchor" aria-label="anchor" href="#using-results-downstream"></a>
</h2>
<p>There are limitations to the above process. For example, you may have your list of projects, but Exeter is involved in a lot. If you’re only interested in a specific thing, this might be a lot of unnecessary data.</p>
<p>Of course, you could use other functions to filter/subset the dataframe you get to land on the bits you’re interested in. But alternatively, you could use your results to run the projects back through <code><a href="../reference/get_resources.html">get_resources()</a></code>, but not apply a project-specific search-term.</p>
<p>In some instances you may have no option but to take this approach. Specifically, if you want to see the outcomes of a set of projects. You can’t directly look at ‘outcomes from UoE projects’, you have to find the projects first, then get their outcomes in a separate step.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#get the project ids you're interested in</span>
<span class="va">project_ids</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">id</span>

<span class="co">#now run them back through `query_combination_all()`</span>
<span class="co">#we're using `purrr::safely()` as some projects may not have publications, in which case the url we're trying doesn't exist</span>
<span class="co">#this way we will 'catch' the error rather than see the function fail</span>
<span class="va">publications</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">project_ids</span>,
  .f <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html" class="external-link">safely</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/get_resources.html">get_resources</a></span><span class="op">(</span>resource <span class="op">=</span> <span class="st">"project"</span>, output <span class="op">=</span> <span class="st">"publication"</span>, resource_id <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> |&gt;
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df</a></span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Shane Jackson &amp; Joe Way <a href="mailto:joefway@gmail.com" class="email">joefway@gmail.com</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
